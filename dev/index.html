<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>开发指南 | A8K</title>
    <meta name="generator" content="VuePress 1.5.3">
    
    <meta name="description" content="基于 webpack 的最佳实践配置的前端工程化工具">
    <link rel="preload" href="/a8k/assets/css/0.styles.dfe690aa.css" as="style"><link rel="preload" href="/a8k/assets/js/app.af3373a2.js" as="script"><link rel="preload" href="/a8k/assets/js/2.725ea3ee.js" as="script"><link rel="preload" href="/a8k/assets/js/8.40217b14.js" as="script"><link rel="preload" href="/a8k/assets/js/3.d22063b6.js" as="script"><link rel="prefetch" href="/a8k/assets/js/10.ca27093a.js"><link rel="prefetch" href="/a8k/assets/js/4.49f27d8c.js"><link rel="prefetch" href="/a8k/assets/js/5.d6b508de.js"><link rel="prefetch" href="/a8k/assets/js/6.e4a3ec97.js"><link rel="prefetch" href="/a8k/assets/js/7.05890946.js"><link rel="prefetch" href="/a8k/assets/js/9.7f404717.js">
    <link rel="stylesheet" href="/a8k/assets/css/0.styles.dfe690aa.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/a8k/" class="home-link router-link-active"><!----> <span class="site-name">A8K</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/a8k/guide/" class="nav-link">
  简介
</a></div><div class="nav-item"><a href="/a8k/config/" class="nav-link">
  配置
</a></div><div class="nav-item"><a href="/a8k/dev/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  开发指南
</a></div><div class="nav-item"><a href="https://github.com/hxfdarling/a8k" target="_blank" rel="noopener noreferrer" class="nav-link external">
  在 GitHub 上编辑此页
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/a8k/guide/" class="nav-link">
  简介
</a></div><div class="nav-item"><a href="/a8k/config/" class="nav-link">
  配置
</a></div><div class="nav-item"><a href="/a8k/dev/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  开发指南
</a></div><div class="nav-item"><a href="https://github.com/hxfdarling/a8k" target="_blank" rel="noopener noreferrer" class="nav-link external">
  在 GitHub 上编辑此页
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="开发指南"><a href="#开发指南" class="header-anchor">#</a> 开发指南</h1> <blockquote><p>本文旨在介绍 a8k 项目架构，介绍进行插件开发已经二次开发</p></blockquote> <h2 id="项目架构"><a href="#项目架构" class="header-anchor">#</a> 项目架构</h2> <p>项目采用采用 <code>hook</code> 机制以支持插件能力，其中<code>a8k</code>包是主项目，集成了 webpack 的必要关键配置和性能优化；<code>@a8k/babel-preset</code> 包封装了最新的 JavaScript 特性解析和 jsx 支持。</p> <p>使用的关键技术：</p> <ol><li><code>lerna</code> 由于项目复杂涉及的技术众多，因此用于 <code>lerna</code> 管理多个包(方便发布和调试)</li> <li><code>webpack-chain</code> 为了方便插件动态修改 webpack 配置信息，该库提供灵活的可编程机制动态生成配置文件</li> <li><code>webpack-dev-server</code> 集成 webpack 开发模式的动态更新代码能力</li> <li><code>commander</code>提供命令行能力</li> <li><code>webpack</code>提供模块化打包能力</li> <li><code>babel</code>es 代码转换能力</li> <li><code>sass(dart-sass)</code>提供 sass 预处理语法编译能力</li> <li><code>less</code>提供 less 预处理语法编译能力</li> <li><code>post-css</code>提供 css 兼容性处理</li> <li><code>nunjucks</code>提供 html 模板化能力 <a href="https://mozilla.github.io/nunjucks/" target="_blank" rel="noopener noreferrer">使用文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><code>jest</code> 集成单元测试功能</li> <li><code>eslint</code>检测代码规范</li> <li><code>styleint</code>检测样式规范</li> <li><code>acorn</code>构建结果语法检测</li> <li><code>@commitlint/cli</code>提供 Git commit message 规范检测能力</li> <li><code>yeoman-generator</code> 提供模板项目初始化能力</li></ol> <h2 id="插件开发方式"><a href="#插件开发方式" class="header-anchor">#</a> 插件开发方式</h2> <p>a8k 提供的插件开发主要依赖于 a8k 实例提供的 hook 机制，通过各种 hook 可以方便的定制构建，随意修改构建配置，同时也可以添加额外的命令行工具，以提升开发体验。下面介绍一些插件的代码结构和可以使用的主要 api。</p> <h3 id="插件结构"><a href="#插件结构" class="header-anchor">#</a> 插件结构</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">YouPlugin</span> <span class="token punctuation">{</span>
  name <span class="token operator">=</span> <span class="token string">'you plugin name'</span><span class="token punctuation">;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token operator">=</span> options<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 必须提供的方法，在插件挂载时调用</span>
  <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// context 是a8k实例对象，所有的api由该对象提供</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="api"><a href="#api" class="header-anchor">#</a> API</h3> <h3 id="context-config"><a href="#context-config" class="header-anchor">#</a> context.config</h3> <p>类型<code>A8kConfig</code>,可以访问当前项目的配置信息</p> <h3 id="context-internals"><a href="#context-internals" class="header-anchor">#</a> context.internals</h3> <p>类型<code>Internals</code>,其中参数<code>mode</code>表示当前模式是<code>development</code>or<code>production</code>，用于区分是生产模式构建还是开发模式构建</p> <h3 id="context-logger"><a href="#context-logger" class="header-anchor">#</a> context.logger</h3> <p>提供了多个个方法：<code>error</code>,<code>warn</code>,<code>info</code>,<code>debug</code>，用于打印统一格式的日志</p> <h3 id="context-hook-name-string-fn-function"><a href="#context-hook-name-string-fn-function" class="header-anchor">#</a> context.hook(name:string,fn:Function)</h3> <p>类型<code>function</code>，提供两个参数，<code>name</code> 表示需要挂载的钩子名称，<code>fn</code> 是回调函数。</p> <p>示例：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">A8kPlugin</span> <span class="token punctuation">{</span>
  name <span class="token operator">=</span> <span class="token string">'you plugin name'</span><span class="token punctuation">;</span>
  <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    context<span class="token punctuation">.</span><span class="token function">hook</span><span class="token punctuation">(</span><span class="token string">'chainWebpack'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">configChain<span class="token punctuation">,</span> <span class="token punctuation">{</span> type <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">'web'</span> <span class="token operator">&amp;&amp;</span> context<span class="token punctuation">.</span>internals<span class="token punctuation">.</span>mode <span class="token operator">===</span> <span class="token string">'development'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        configChain<span class="token punctuation">.</span><span class="token function">plugin</span><span class="token punctuation">(</span><span class="token string">'plugin-name'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'plugin'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'params1'</span><span class="token punctuation">,</span> <span class="token string">'params2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        configChain<span class="token punctuation">.</span><span class="token function">plugin</span><span class="token punctuation">(</span><span class="token string">'xxx'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token parameter">options</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token punctuation">{</span> options<span class="token punctuation">,</span> extraOption<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>使用插件,在项目的<code>a8k.config.js</code>配置中添加</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 省略其他配置</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'you-plugin-module'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">// or plugins:[require(&quot;you-plugin-module&quot;)]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="context-registercommand-name-string-command"><a href="#context-registercommand-name-string-command" class="header-anchor">#</a> context.registerCommand(name:string):Command</h3> <p>类型<code>function</code>，用于注册命令行命令。参数<code>name</code>是注册命令的名字，将会返回一个命令对象，可以在上面添加该命令的参数和描述信息以及回调函数。</p> <p>示例代码：</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token keyword">class</span> <span class="token class-name">Plugin</span> <span class="token punctuation">{</span>
  name <span class="token operator">=</span> <span class="token string">'you plugin name'</span><span class="token punctuation">;</span>
  <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    context
      <span class="token punctuation">.</span><span class="token function">registerCommand</span><span class="token punctuation">(</span><span class="token string">'demo'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">description</span><span class="token punctuation">(</span><span class="token string">'a8k命令行demo'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">'-d,--data [data]'</span><span class="token punctuation">,</span> <span class="token string">'external option'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">action</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> data <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>使用方式</p> <div class="language-shell extra-class"><pre class="language-shell"><code>k demo -d <span class="token builtin class-name">test</span> demo
<span class="token comment">## output: test demo</span>
</code></pre></div><h3 id="context-registercreatetype-type-string-description-string-action-function"><a href="#context-registercreatetype-type-string-description-string-action-function" class="header-anchor">#</a> context.registerCreateType(type:string,description:string,action:Function)</h3> <p>注册项目模板，可以扩展项目模板。type 表示项目类型，description 描述信息，action 回调函数。
示例：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Plugin</span> <span class="token punctuation">{</span>
  name <span class="token operator">=</span> <span class="token string">'you plugin name'</span><span class="token punctuation">;</span>
  <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    context
      <span class="token punctuation">.</span><span class="token function">registerCreateType</span><span class="token punctuation">(</span><span class="token string">'vue'</span><span class="token punctuation">,</span> <span class="token string">'vue模板项目'</span><span class="token function">，</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> type<span class="token punctuation">,</span> name<span class="token punctuation">,</span> projectDir <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>使用方式：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>k create you-project-name vue
</code></pre></div><h2 id="模板项目开发"><a href="#模板项目开发" class="header-anchor">#</a> 模板项目开发</h2> <p>模板项目可以参考 a8k 项目下<code>packages/plugin-react-template</code></p> <blockquote><p>更多 api 参考<a href="https://github.com/hxfdarling/a8k/blob/master/packages/a8k/src/index.ts#L28" target="_blank" rel="noopener noreferrer">a8k 入口文件定义<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>
</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">9/3/2019, 11:11:19 AM</span></div></footer> <!----> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/a8k/assets/js/app.af3373a2.js" defer></script><script src="/a8k/assets/js/2.725ea3ee.js" defer></script><script src="/a8k/assets/js/8.40217b14.js" defer></script><script src="/a8k/assets/js/3.d22063b6.js" defer></script>
  </body>
</html>
